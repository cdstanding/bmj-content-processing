<?xml version="1.0" encoding="UTF-8"?>
<pages monograph_type="eval">
	<page label="emergencies.urgent-considerations">
		<retrieval-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/urgent-considerations,
                  <redflags>
                  { 
                      for $x in /monograph-eval/differentials/differential[@red-flag = 'true' and @common = 'true']
                          return $x 
                  }
                  { 
                      for $x in /monograph-eval/differentials/differential[@red-flag = 'true' and @common = 'false']
                          return $x
                  }
                  </redflags>
              ]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/urgent-considerations,
                  /monograph-eval/differentials
              ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="emergencies.red-flags">
		<retrieval-xquery>
			<body>
				<![CDATA[
			<redflags>
					{ 
                      for $x in	/monograph-eval/differentials/differential[@red-flag = 'true' and @common = 'true']
                          return $x 
                    }
					{ 
                      for $x in /monograph-eval/differentials/differential[@red-flag = 'true' and @common = 'false']
                          return $x
                    }
			</redflags>
			]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
		   /monograph-eval/differentials
		    ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="overview.summary.by-category">
		<retrieval-xquery>
			<body>
				<![CDATA[
				<summary>
					{
						for $x in /monograph-eval/overview
						return $x
					}
					<differentials>
					{
						let $x := for $category in /monograph-eval/differentials/differential/category
							  return normalize-space($category)

						for $category in distinct-values($x)
						return
						<category>
							<name>{$category}</name>
							{
							for $differential in /monograph-eval/differentials/differential
							where normalize-space($differential/category) = $category
							return
							<differential>
								{$differential/@id}
								{$differential/ddx-name}
							</differential>							
							}
						</category>
					}
					</differentials>	
				</summary>
              ]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/overview,
                  /monograph-eval/differentials
              ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="overview.summary">
		<retrieval-xquery>
			<body>
				<![CDATA[
				<summary>
					{
						for $x in /monograph-eval/overview
						return $x
					}
					<differentials>
						<common>
						{
							for $differential in /monograph-eval/differentials/differential[@common='true']
							return
							<differential>
								{$differential/@id}
								{$differential/ddx-name}
							</differential>		
						}
						</common>
						<uncommon>
						{
							for $differential in /monograph-eval/differentials/differential[@common='false']
							return
							<differential>
								{$differential/@id}
								{$differential/ddx-name}
							</differential>		
						}
						</uncommon>					
					</differentials>	
				</summary>
              ]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/overview,
                  /monograph-eval/differentials
              ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="overview.aetiology">
		<retrieval-xquery>
			<body>
				<![CDATA[
		            /monograph-eval/ddx-etiology
        		]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/ddx-etiology
              ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="diagnosis.step-by-step">
		<retrieval-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/diagnostic-approach
              ]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/diagnostic-approach
              ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="diagnosis.differential-diagnosis.by-category">
		<retrieval-xquery>
			<body>
				<![CDATA[
                  <differentials>
                    {
						let $x := for $category in /monograph-eval/differentials/differential/category
									return normalize-space($category)

						for $category in distinct-values($x)
						return
                        <category>
                            <name>{$category}</name>
                            {
                            for $differential in /monograph-eval/differentials/differential
                            where normalize-space($differential/category) = $category
                            return $differential
                            }
                        </category>
                    }
                    </differentials>    
                ]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/differentials
                ]]>
			</body>
		</presence-xquery>
	</page>
	<page label="diagnosis.differential-diagnosis">
		<retrieval-xquery>
			<body>
				<![CDATA[
                  <differentials>
                        <common>
                        <name>Common</name>
                        {
                            for $differential in /monograph-eval/differentials/differential[@common='true']
                            return $differential
                        }
                        </common>
                        <uncommon>
                        <name>Uncommon</name>
                        {
                            for $differential in /monograph-eval/differentials/differential[@common='false']
                            return $differential
                        }
                        </uncommon>                 
                    </differentials>    
                ]]>
			</body>
		</retrieval-xquery>
		<presence-xquery>
			<body>
				<![CDATA[
                  /monograph-eval/differentials
                ]]>
			</body>
		</presence-xquery>
	</page>
   <page label="diagnosis.guidelines">
    <retrieval-xquery>
      <body>
        <![CDATA[
            <diagnosis-guidlines>
            {
              for $region in ("Asia", "Africa", "Europe", "International", "Latin America", "North America", "Oceania")
              let $x:= /monograph-eval/guidelines/guideline[ @region=$region]
              return if($x/*) 
                        then <region id='{data($region)}'>{$x}</region>
                        else <xxx></xxx>
            }
            <non-region>
            {
              for $y in /monograph-eval/guidelines/guideline 
              return if($y[@region]) 
                     then <xxx></xxx>
                     else $y
            }
            </non-region>
            </diagnosis-guidlines>
        ]]>
      </body>
    </retrieval-xquery>
    <presence-xquery>
      <body>
        <![CDATA[
            /monograph-eval/guidelines   
        ]]>
      </body>
    </presence-xquery>
  </page>
	<page label="resources.references">
    <retrieval-xquery xqref="resources.references.retrieval" />
    <presence-xquery xqref="resources.references.presence" />
  </page>
  
  <page label="resources.reference.bp">
    <retrieval-xquery xqref="resources.reference.bp" />
    <presence-xquery />
  </page>
	
	<page label="resources.images">
    <retrieval-xquery xqref="resources.images" />
    <presence-xquery xqref="resources.images.presence" />
  </page>
  
  <page label="resources.images.print">
    <retrieval-xquery xqref="resources.images.print" />
    <presence-xquery />
  </page>
  
  <page label="resources.image.bp">
    <retrieval-xquery xqref="resources.image.bp" />
    <presence-xquery />
  </page>
  
  <page label="resources.online-resources">
    <retrieval-xquery xqref="resources.online-resources" />
    <presence-xquery xqref="resources.online-resources" />
  </page>

  <page label="resources.patient-leaflets">
    <retrieval-xquery xqref="resources.patient-leaflets" />
    <presence-xquery xqref="resources.patient-leaflets" />
  </page>
  
  <page label="resources.credits">
    <retrieval-xquery xqref="resources.credits.retrieval" />
    <presence-xquery xqref="resources.credits.presence" />
  </page>

  <!-- 
    For evidence XQueries see xqueries/systematic-review-xqueries.xml
    NB evals are not supposed to have linked evidence, but they do have popup evidence
    scores - these are supposed to link to external sources, not CE data.
    
    However, I don't trust editorial not to sneak in the odd link to CE here, so
    I've implemented the whole treatment/evidence stack just in case, so that we
    have pages to link to, otherwise the user would get an error.
  -->

  <page label="treatment.evidence">
    <retrieval-xquery xqref="systematic-reviews.questions.retrieval" />
    <presence-xquery xqref="systematic-reviews.questions.presence" />
  </page>
  <page label="treatment.evidence.question">
    <retrieval-xquery xqref="systematic-review.question" />
    <presence-xquery />
  </page>
  <page label="treatment.evidence.intervention">
    <retrieval-xquery xqref="systematic-review.intervention" />
    <presence-xquery />
  </page>
  <page label="treatment.evidence.table">
    <retrieval-xquery xqref="systematic-review.table" />
    <presence-xquery />
  </page>
  <page label="treatment.evidence.glossary">
    <retrieval-xquery xqref="systematic-review.glossary" />
    <presence-xquery />
  </page>
  <page label="treatment.evidence.key-points">
    <retrieval-xquery xqref="systematic-review.key-points"/>
    <presence-xquery />
  </page>
  <page label="treatment.evidence.background">
    <retrieval-xquery xqref="systematic-review.background"/>
    <presence-xquery />
  </page>



  <page label="treatment.evidence.score">
    <retrieval-xquery xqref="treatment.evidence.score" />
    <presence-xquery />
  </page>
  <page label="treatment.evidence.scorepopup">
    <retrieval-xquery xqref="treatment.evidence.score" />
    <presence-xquery />
  </page>

  <page label="treatment.evidence.references">
    <retrieval-xquery xqref="systematic-review.references" />
    <presence-xquery />
  </page>
  <page label="treatment.evidence.reference">
    <retrieval-xquery xqref="systematic-review.reference" />
    <presence-xquery />
  </page>
  <page label="resources.guideline.nice">
    <retrieval-xquery xqref="resources.nice-guideline" />
    <presence-xquery />
  </page>

</pages>
